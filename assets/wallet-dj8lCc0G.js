import{P as l,a as n,D as o}from"./index-lJ9Ej1SP.js";const c=l("wallet",{state:()=>({balance:0,loading:!1,error:null}),getters:{hasBalance:s=>s.balance>0},actions:{async fetchWallet(){var r,t;const s=n();if(s.isLoggedIn){this.loading=!0,this.error=null;try{const e=await o.get(`/wallet/${(r=s.user)==null?void 0:r.id}`);this.balance=e.data.balance,s.updateUserBalance(e.data.balance)}catch(e){console.error("获取余额失败:",e),this.error=((t=e.response)==null?void 0:t.data)||"获取余额失败"}finally{this.loading=!1}}},async deposit(s){var t,e;const r=n();if(r.isLoggedIn){this.loading=!0,this.error=null;try{const a=await o.post("/wallet/deposit",{userId:(t=r.user)==null?void 0:t.id,amount:s});return this.balance=a.data.balance,r.updateUserBalance(a.data.balance),a.data}catch(a){throw console.error("充值失败:",a),this.error=((e=a.response)==null?void 0:e.data)||"充值失败",a}finally{this.loading=!1}}},async withdraw(s){var t,e;const r=n();if(r.isLoggedIn){this.loading=!0,this.error=null;try{const a=await o.post("/wallet/withdraw",{userId:(t=r.user)==null?void 0:t.id,amount:s});return this.balance=a.data.balance,r.updateUserBalance(a.data.balance),a.data}catch(a){throw console.error("提现失败:",a),this.error=((e=a.response)==null?void 0:e.data)||"提现失败",a}finally{this.loading=!1}}},async payOrder(s){var t,e;const r=n();if(r.isLoggedIn){this.loading=!0,this.error=null;try{const a=await o.post("/wallet/pay",{userId:(t=r.user)==null?void 0:t.id,orderId:s});return this.balance=a.data.balance,r.updateUserBalance(a.data.balance),a.data}catch(a){throw console.error("支付失败:",a),this.error=((e=a.response)==null?void 0:e.data)||"支付失败",a}finally{this.loading=!1}}},async refundOrder(s){var t;const r=n();this.loading=!0,this.error=null;try{const e=await o.post("/wallet/refund",{orderId:s});return this.balance=e.data.balance,r.updateUserBalance(e.data.balance),e.data}catch(e){throw console.error("退款失败:",e),this.error=((t=e.response)==null?void 0:t.data)||"退款失败",e}finally{this.loading=!1}},async batchPayOrders(s){var t,e;const r=n();if(r.isLoggedIn){this.loading=!0,this.error=null;try{const a=await o.post("/wallet/batch-pay",{userId:(t=r.user)==null?void 0:t.id,orderIds:s});return this.balance=a.data.balance,r.updateUserBalance(a.data.balance),a.data}catch(a){throw console.error("批量支付失败:",a),this.error=((e=a.response)==null?void 0:e.data)||"批量支付失败",a}finally{this.loading=!1}}}}});export{c as u};
