import{d as ae,u as oe,a as se,b as ne,c as re,r as B,o as le,e as ie,f as ce,w as ue,g,h as s,i as $,j as S,k as z,l as r,m as I,n as y,p as i,q as h,s as de,F as L,t as M,v as c,x as ye,y as v,z as b,A as q,B as pe,E as P,C as A,D as me,_ as ge}from"./index-lJ9Ej1SP.js";const ve={class:"home"},fe={class:"search-bar"},_e={class:"search-inputs"},he={class:"search-buttons"},ke={class:"category-nav"},Ce={class:"book-list"},we={key:1,class:"books-container"},Be={class:"book-info"},be=["onClick"],qe={class:"book-author"},Pe={key:0,class:"book-category"},xe={class:"book-price"},Qe={class:"card-footer"},$e={class:"quantity-selector"},Se={class:"quantity-control-group"},Ve=["onClick"],Te={class:"custom-quantity-input"},ze=["onUpdate:modelValue"],Ie=["onClick"],Le={class:"card-buttons"},Me={key:2,class:"pagination-container"},Ae=ae({name:"Home",__name:"Home",setup(De){const x={novel:"文学小说",technology:"科技计算机",education:"社会科学",economics:"经济管理",history:"历史传记",art:"艺术设计",children:"儿童读物"},D=e=>{if(!e)return"未知分类";const t=e.trim().replace(/\s+/g,"");if(x[t.toLowerCase()])return x[t.toLowerCase()];for(const n in x)if(t.toLowerCase().includes(n.toLowerCase()))return x[n];return"未知分类"},p=ye(),f=ie(),a=oe(),V=se(),N=ne(),U=re(),k=B(""),C=B(""),u=B("all"),l=B(!1),d=B([]),E=[{key:"novel",label:"文学小说"},{key:"technology",label:"科技计算机"},{key:"education",label:"社会科学"},{key:"economics",label:"经济管理"},{key:"history",label:"历史传记"},{key:"art",label:"艺术设计"},{key:"children",label:"儿童读物"}],w=async()=>{l.value=!0;try{await a.fetchPagedBooks(1,20),d.value=a.books.map(e=>({...e,orderQuantity:1}))}catch(e){console.error("获取图书数据出错:",e)}finally{l.value=!1}},F=async e=>{l.value=!0;try{u.value==="all"?(p.replace({query:{page:e.toString()}}),await a.fetchPagedBooks(e,20)):(p.replace({query:{category:u.value,page:e.toString()}}),await a.fetchBooksByCategoryPaged(u.value,e,20)),d.value=a.books.map(t=>({...t,orderQuantity:1}))}catch(t){console.error("分页获取图书数据出错:",t)}finally{l.value=!1}};le(async()=>{await a.fetchAllCategories();const e=f.query.category,t=f.query.page?parseInt(f.query.page):1;e?(u.value=e,await a.fetchBooksByCategoryPaged(e,t,20)):t>1?await a.fetchPagedBooks(t,20):await w(),d.value=a.books.map(n=>({...n,orderQuantity:1}))}),ce(()=>{const e=f.query.category,t=f.query.page?parseInt(f.query.page):1;(d.value.length===0||e||t>1)&&(a.fetchAllCategories(),e?(u.value=e,a.fetchBooksByCategoryPaged(e,t,20)):t>1?a.fetchPagedBooks(t,20):w())}),ue(()=>a.books,e=>{d.value=e.map(t=>({...t,orderQuantity:1}))},{deep:!0});const Q=async()=>{k.value.trim()||C.value.trim()?(l.value=!0,await a.searchBooks(k.value.trim()||void 0,C.value.trim()||void 0),d.value=a.books.map(e=>({...e,orderQuantity:1})),l.value=!1):await w()},H=async()=>{k.value="",C.value="",u.value="all",p.replace({query:{page:"1"}}),await w()},K=async e=>{u.value=e,l.value=!0,e==="all"?(p.replace({query:{page:"1"}}),await a.fetchPagedBooks(1,20)):(p.replace({query:{category:e,page:"1"}}),await a.fetchBooksByCategoryPaged(e,1,20)),d.value=a.books.map(t=>({...t,orderQuantity:1})),l.value=!1},O=e=>{p.push({path:`/book/${e}`,query:{fromCategory:u.value,fromPage:a.currentPage.toString()}})},j=e=>{e.orderQuantity<20&&e.orderQuantity++},R=e=>{e.orderQuantity>1&&e.orderQuantity--},G=async e=>{if(!V.isLoggedIn){P.warning("请先登录后再进行操作"),p.push("/login");return}const t=e.orderQuantity||1;A.confirm(`确定要将 ${t} 本《${e.title}》加入订单吗？`,"加入订单",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{var n;try{await me.post("https://smart-book-city.onrender.com/api/orders/book",{userId:(n=V.user)==null?void 0:n.id,bookId:e.id,quantity:t}),P.success({message:`已将 ${t} 本《${e.title}》加入订单`,duration:1e3,showClose:!0,type:"success"}),await U.updatePendingOrdersCount(),e.orderQuantity=1}catch(m){console.error("创建订单失败:",m),P.error({message:`添加《${e.title}》到订单失败，请重试`,duration:5e3,showClose:!0,type:"error"})}}).catch(()=>{})},J=async e=>{const t=e.orderQuantity||1;A.confirm(`确定要将 ${t} 本《${e.title}》加入购物车吗？`,"加入购物车",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(async()=>{try{await N.addToCart(e,t),P.success({message:`已将 ${t} 本《${e.title}》加入购物车`,duration:1e3,showClose:!0,type:"success"}),e.orderQuantity=1}catch(n){console.error("添加到购物车失败:",n),P.error(`添加《${e.title}》到购物车失败: ${n.message||"未知错误"}`)}}).catch(()=>{})};return(e,t)=>{const n=y("el-input"),m=y("el-button"),T=y("el-menu-item"),W=y("el-menu"),X=y("el-alert"),Y=y("el-empty"),Z=y("el-card"),ee=y("el-pagination"),te=de("loading");return c(),g("div",ve,[t[10]||(t[10]=s("div",{class:"banner"},[s("h1",null,"欢迎来到智慧书城"),s("p",null,"探索知识的海洋，发现阅读的乐趣")],-1)),s("div",fe,[s("div",_e,[r(n,{modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=o=>k.value=o),placeholder:"输入书籍名称",class:"search-input",onKeyup:I(Q,["enter"])},null,8,["modelValue"]),r(n,{modelValue:C.value,"onUpdate:modelValue":t[1]||(t[1]=o=>C.value=o),placeholder:"输入作者名称",class:"search-input",onKeyup:I(Q,["enter"])},null,8,["modelValue"]),s("div",he,[r(m,{onClick:Q,type:"primary",class:"action-button"},{default:i(()=>t[3]||(t[3]=[v(" 搜索 ")])),_:1}),r(m,{onClick:H,type:"info",class:"action-button"},{default:i(()=>t[4]||(t[4]=[v(" 重置 ")])),_:1})])])]),s("div",ke,[r(W,{mode:"horizontal","default-active":u.value,onSelect:K,ellipsis:!1},{default:i(()=>[r(T,{index:"all"},{default:i(()=>t[5]||(t[5]=[v("全部图书")])),_:1}),(c(),g(L,null,M(E,o=>r(T,{key:o.key,index:o.key},{default:i(()=>[v(b(o.label),1)]),_:2},1032,["index"])),64))]),_:1},8,["default-active"])]),h(a).error?(c(),$(X,{key:0,title:h(a).error,type:"warning","show-icon":"",closable:!0,style:{"margin-bottom":"20px"}},null,8,["title"])):S("",!0),z((c(),g("div",Ce,[d.value.length===0&&!l.value?(c(),$(Y,{key:0,description:"暂无图书"},{default:i(()=>[r(m,{type:"primary",onClick:w},{default:i(()=>t[6]||(t[6]=[v("刷新图书")])),_:1})]),_:1})):(c(),g("div",we,[(c(!0),g(L,null,M(d.value,o=>(c(),$(Z,{key:o.id,class:"book-card"},{default:i(()=>[s("div",Be,[s("h3",{class:"book-title",onClick:_=>O(o.id)},b(o.title),9,be),s("p",qe,b(o.author),1),o.category?(c(),g("p",Pe,b(D(o.category)),1)):S("",!0),s("p",xe,"¥"+b(o.price),1)]),s("div",Qe,[s("div",$e,[t[7]||(t[7]=s("span",{class:"quantity-label"},"数量：",-1)),s("div",Se,[s("button",{class:"quantity-btn decrease",onClick:q(_=>R(o),["stop"])},"-",8,Ve),s("div",Te,[z(s("input",{type:"number","onUpdate:modelValue":_=>o.orderQuantity=_,min:"1",max:"20",onClick:t[2]||(t[2]=q(()=>{},["stop"])),class:"quantity-input-field"},null,8,ze),[[pe,o.orderQuantity]])]),s("button",{class:"quantity-btn increase",onClick:q(_=>j(o),["stop"])},"+",8,Ie)])]),s("div",Le,[r(m,{type:"primary",size:"default",onClick:q(_=>G(o),["stop"]),class:"action-btn"},{default:i(()=>t[8]||(t[8]=[v(" 加入订单 ")])),_:2},1032,["onClick"]),r(m,{type:"success",size:"default",onClick:q(_=>J(o),["stop"]),class:"action-btn"},{default:i(()=>t[9]||(t[9]=[v(" 加入购物车 ")])),_:2},1032,["onClick"])])])]),_:2},1024))),128))])),h(a).totalPages>0?(c(),g("div",Me,[r(ee,{background:"",layout:"prev, pager, next, jumper",total:h(a).totalBooks,"page-size":h(a).pageSize,"current-page":h(a).currentPage,onCurrentChange:F},null,8,["total","page-size","current-page"])])):S("",!0)])),[[te,l.value]])])}}}),Ue=ge(Ae,[["__scopeId","data-v-b5a7eefe"]]);export{Ue as default};
