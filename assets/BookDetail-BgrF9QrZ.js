import{d as V,u as $,a as D,b as T,c as E,r as m,o as M,e as O,g as u,l as r,n as b,z as n,h as s,p as g,v as c,y as _,x as P,E as l,D as R,_ as U}from"./index-lJ9Ej1SP.js";const z={class:"book-detail-container"},j={key:0,class:"loading"},A={key:1,class:"error"},F={key:2,class:"book-detail"},G={class:"page-header"},H={class:"title-container"},J={class:"book-title"},K={class:"book-info"},Q={class:"book-author"},W={class:"book-price"},X={class:"book-category"},Y={class:"book-description"},Z={class:"actions"},ee={key:3,class:"not-found"},oe=V({__name:"BookDetail",setup(te){const d={novel:"文学小说",novell:"文学小说",literature:"文学小说",drama:"文学小说",poetry:"文学小说",technology:"科技计算机",science:"科技计算机",design:"科技计算机",environment:"科技计算机",education:"社会科学",sociology:"社会科学",philosophy:"社会科学",psychology:"社会科学",economics:"经济管理",management:"经济管理",marketing:"经济管理",history:"历史传记",biography:"历史传记",military:"历史传记",art:"艺术设计",film:"艺术设计",game:"艺术设计",children:"儿童读物"},k=O(),i=P(),C=$(),f=D(),B=T(),S=E(),x=t=>{if(!t)return"未分类";const e=t.trim().replace(/\s+/g,"");if(d[e.toLowerCase()])return d[e.toLowerCase()];for(const v in d)if(e.toLowerCase().includes(v.toLowerCase()))return d[v];return"未分类"},o=m(null),h=m(!0),p=m(null),a=m(1);M(async()=>{const t=Number(k.params.id);if(isNaN(t)){p.value="无效的图书ID",h.value=!1;return}try{await C.fetchBookById(t),o.value=C.currentBook}catch(e){p.value="获取图书信息失败",console.error(e)}finally{h.value=!1}});const I=async()=>{var t;if(o.value){if(!f.isLoggedIn){l.warning("请先登录后再进行操作"),i.push("/login");return}try{await R.post("https://smart-book-city.onrender.com/api/orders/book",{userId:(t=f.user)==null?void 0:t.id,bookId:o.value.id,quantity:a.value}),l.success({message:`已将 ${a.value} 本《${o.value.title}》加入订单`,duration:1e3,showClose:!0,type:"success"}),await S.updatePendingOrdersCount(),a.value=1}catch(e){console.error("创建订单失败:",e),l.error({message:`添加《${o.value.title}》到订单失败，请重试`,duration:5e3,showClose:!0,type:"error"})}}},N=async()=>{if(o.value){if(!f.isLoggedIn){l.warning("请先登录后再进行操作"),i.push("/login");return}try{await B.addToCart(o.value,a.value),l.success({message:`已将 ${a.value} 本《${o.value.title}》加入购物车`,duration:1e3,showClose:!0,type:"success"}),a.value=1}catch(t){console.error("添加到购物车失败:",t),l.error({message:`添加《${o.value.title}》到购物车失败，请重试`,duration:5e3,showClose:!0,type:"error"})}}},w=()=>{const t=k.query.fromCategory,e=k.query.fromPage;t?t==="all"?i.push({path:"/home",query:{page:e||"1"}}):i.push({path:"/home",query:{category:t,page:e||"1"}}):i.back()};return(t,e)=>{const v=b("el-skeleton"),y=b("el-button"),q=b("el-input-number");return c(),u("div",z,[h.value?(c(),u("div",j,[r(v,{rows:10,animated:""})])):p.value?(c(),u("div",A,n(p.value),1)):o.value?(c(),u("div",F,[s("div",G,[r(y,{type:"primary",onClick:w,class:"back-button"},{default:g(()=>e[1]||(e[1]=[_("返回")])),_:1})]),s("div",H,[s("h1",J,n(o.value.title),1)]),s("div",K,[s("p",Q,"作者："+n(o.value.author),1),s("p",W,"价格：¥"+n(o.value.price),1),s("p",X,"分类："+n(x(o.value.category)),1),s("div",Y,[e[2]||(e[2]=s("h3",null,"图书简介",-1)),s("p",null,n(o.value.description),1)]),s("div",Z,[r(q,{modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=L=>a.value=L),min:1,max:o.value.stock,step:1},null,8,["modelValue","max"]),r(y,{type:"primary",onClick:I,disabled:o.value.stock<=0},{default:g(()=>e[3]||(e[3]=[_(" 加入订单 ")])),_:1},8,["disabled"]),r(y,{type:"success",onClick:N,disabled:o.value.stock<=0},{default:g(()=>e[4]||(e[4]=[_(" 加入购物车 ")])),_:1},8,["disabled"])])])])):(c(),u("div",ee,[e[6]||(e[6]=s("h2",null,"图书不存在",-1)),r(y,{type:"primary",onClick:w},{default:g(()=>e[5]||(e[5]=[_("返回")])),_:1})]))])}}}),ae=U(oe,[["__scopeId","data-v-f1645660"]]);export{ae as default};
