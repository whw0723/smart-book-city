import{d as T,a as B,b as E,r as u,G as x,o as M,H as w,w as q,g as S,h as i,l as s,p as t,n as l,v as h,A as j,y,j as G,x as H,E as V,_ as z}from"./index-lJ9Ej1SP.js";const D={class:"login-content"},J={class:"card-header"},K={class:"form-footer"},O={key:0},P=T({__name:"Login",setup(Q){const f=B(),n=E(),b=H(),g=u(),I=u(null),_=u(!1),o=u("user"),m=u(null),d=u(null),a=x({username:"",password:""});M(async()=>{const r=localStorage.getItem("lastUserUsername"),e=localStorage.getItem("lastAdminUsername");o.value==="user"&&r?a.username=r:o.value==="admin"&&e&&(a.username=e),await w(),o.value==="admin"&&d.value?d.value.focus():m.value&&m.value.focus()}),q(o,async r=>{if(a.password="",r==="user"){const e=localStorage.getItem("lastUserUsername");a.username=e||"",await w(),m.value&&m.value.focus()}else{const e=localStorage.getItem("lastAdminUsername");a.username=e||"",await w(),d.value&&d.value.focus()}});const k=x({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度应为3到20个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度应为6到20个字符",trigger:"blur"}]}),C=async()=>{g.value&&await g.value.validate(async r=>{if(r){_.value=!0;try{const e=await f.login(a.username,a.password,o.value);if(e.success){if(V.success({message:"登录成功",duration:1e3}),o.value==="user"?localStorage.setItem("lastUserUsername",a.username):localStorage.setItem("lastAdminUsername",a.username),o.value==="user"&&!f.isAdmin)try{await n.fetchCart(),console.log("已从服务器加载购物车数据"),n.items.length===0&&(n.loadFromLocalStorage(),n.items.length>0&&(await n.syncCartToServer(),console.log("已将本地购物车数据同步到服务器")))}catch(p){console.error("处理购物车数据失败:",p),n.loadFromLocalStorage()}o.value==="admin"&&f.isAdmin?b.push("/admin"):b.push("/home")}else V.error(e.message)}finally{_.value=!1}}})};return(r,e)=>{const p=l("el-radio-button"),R=l("el-radio-group"),U=l("el-input"),v=l("el-form-item"),A=l("el-button"),F=l("el-form"),L=l("router-link"),N=l("el-card");return h(),S("div",{class:"login-container",ref_key:"loginContainerRef",ref:I},[i("div",D,[e[6]||(e[6]=i("div",{class:"login-title"},[i("h1",null,"智慧书城"),i("p",null,"探索知识的海洋，发现阅读的乐趣")],-1)),s(N,{class:"login-card"},{header:t(()=>[i("div",J,[s(R,{modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=c=>o.value=c),style:{width:"100%"}},{default:t(()=>[s(p,{value:"user",label:"用户登录"}),s(p,{value:"admin",label:"管理员登录"})]),_:1},8,["modelValue"])])]),default:t(()=>[s(F,{model:a,rules:k,ref_key:"loginFormRef",ref:g,"label-position":"left","label-width":"70px",onSubmit:j(C,["prevent"])},{default:t(()=>[s(v,{label:"用户名",prop:"username"},{default:t(()=>[s(U,{modelValue:a.username,"onUpdate:modelValue":e[1]||(e[1]=c=>a.username=c),placeholder:"请输入用户名",clearable:"",style:{width:"220px"},ref_key:"usernameInputRef",ref:m},null,8,["modelValue"])]),_:1}),s(v,{label:"密码",prop:"password"},{default:t(()=>[s(U,{modelValue:a.password,"onUpdate:modelValue":e[2]||(e[2]=c=>a.password=c),type:"password",placeholder:"请输入密码","show-password":"",clearable:"",style:{width:"220px"},ref_key:"passwordInputRef",ref:d},null,8,["modelValue"])]),_:1}),s(v,null,{default:t(()=>[s(A,{type:"primary",loading:_.value,style:{width:"150px","margin-left":"70px"},"native-type":"submit"},{default:t(()=>e[3]||(e[3]=[y(" 登录 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"]),i("div",K,[o.value==="user"?(h(),S("p",O,[e[5]||(e[5]=y(" 还没有账号？ ")),s(L,{to:"/register"},{default:t(()=>e[4]||(e[4]=[y("立即注册")])),_:1})])):G("",!0)])]),_:1})])],512)}}}),X=z(P,[["__scopeId","data-v-e9790eb9"]]);export{X as default};
