import{d as Dt,a as Bt,r as i,o as Ke,E as p,x as At,e as Et,D as x,L as Q,J as Ot,H as Ut,K as It,w as xe,g as h,l as o,h as l,p as n,n as m,F as X,v as y,q as fe,Q as Rt,R as $t,S as Pt,T as Ft,j as le,y as v,z as c,m as Z,t as oe,M as Tt,C as We,_ as Nt}from"./index-lJ9Ej1SP.js";import{A as qt}from"./AdminNavbar-QXUN9gnu.js";const Kt={class:"admin-container"},Wt={key:0},Yt={class:"action-bar"},jt={class:"left-actions"},Gt={key:0,class:"selection-info"},Ht={class:"search-container"},Jt={class:"pagination-container"},Qt={key:1},Xt={class:"action-bar"},Zt={class:"search-container"},ea={class:"pagination-container"},ta={key:2},aa={class:"action-bar"},la={class:"search-container"},oa={class:"custom-table"},sa={class:"pagination-container"},na={key:3,class:"stats-container"},ra={class:"stats-cards"},ia={class:"stats-card"},ua={class:"stats-card-value"},da={class:"stats-card"},ca={class:"stats-card-value"},va={class:"stats-card"},pa={class:"stats-card-value"},ma={class:"stats-card"},ga={class:"stats-card-value"},fa={class:"stats-charts"},ha={class:"stats-chart-container"},ya={class:"chart-tabs"},ba=["onClick"],wa={class:"stats-chart-container"},ka={class:"stats-chart-container"},_a={class:"stats-chart-container"},xa={class:"dialog-footer"},Ca={key:0,class:"loading-detail"},Sa={key:1,class:"admin-order-detail-content"},Va={class:"detail-header"},za={class:"detail-row"},La={class:"detail-value"},Ma={class:"detail-row"},Da={class:"detail-value"},Ba={class:"detail-row"},Aa={class:"detail-value"},Ea={class:"detail-row"},Oa={class:"detail-body"},Ua={class:"admin-order-items-table"},Ia={class:"detail-footer"},Ra={class:"total-amount"},$a={class:"amount-value"},Pa={key:2},Fa={class:"dialog-footer"},Ta=Dt({__name:"Admin",setup(Na){const Ce=At(),he=Et(),Se=Bt(),V=i("books"),se=i(""),O=i(""),U=i(""),I=i(""),R=i(""),$=i(""),z=i(""),M=i(""),D=i(""),P=i(1),A=i(1),F=i(1),b=i(10),B=i(0),T=i(0),L=i([]),ne=i(!1),ye=i(!1),C=i(null),Ve=i(0),w=i([]),K=i([]),W=i({}),E=i([]),Ye=i(!1);Ke(async()=>{var e;if(!Se.isLoggedIn||!Se.isAdmin){p.warning("请先登录管理员账号"),Ce.push("/login");return}const t=he.query.activeMenu;t&&["books","users","orders","stats"].includes(t)&&(V.value=t,console.log("从URL查询参数设置活动菜单:",t));try{const a=await x.get("https://smart-book-city.onrender.com/api/books");a.data&&a.data.success&&Array.isArray(a.data.data)?w.value=a.data.data:a.data&&Array.isArray(a.data)?w.value=a.data:(console.warn("书籍数据格式不正确:",a.data),p.error(((e=a.data)==null?void 0:e.message)||"加载书籍数据失败"))}catch(a){console.error("加载书籍数据失败:",a),p.error("加载书籍数据失败")}try{const a=await x.get("https://smart-book-city.onrender.com/api/users/paged",{params:{page:A.value,size:b.value}});console.log("用户数据:",a.data),a.data&&a.data.users?(K.value=a.data.users,B.value=a.data.total||0):a.data&&Array.isArray(a.data.users)?(K.value=a.data.users,B.value=a.data.users.length):console.warn("用户数据格式不正确:",a.data)}catch(a){console.error("加载用户数据失败:",a),p.error("加载用户数据失败")}await ue(),await Ue(),V.value==="stats"&&me()});const je=t=>{V.value=t,Ce.replace({query:{...he.query,activeMenu:t}})},re=()=>{console.log("执行图书搜索，条件：",{title:O.value,author:U.value,category:I.value}),P.value=1},be=()=>{console.log("执行用户搜索，条件:",{username:R.value,email:$.value})},Ge=t=>{E.value=t,Ye.value=t.length>0&&t.length===Le.value.length},He=()=>{if(E.value.length===0){p.warning("请先选择要删除的图书");return}We.confirm(`确定要删除选中的 ${E.value.length} 本图书吗？此操作不可恢复！`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const t=E.value.map(e=>e.id);await x.post("https://smart-book-city.onrender.com/api/books/batch-delete",{bookIds:t}),w.value=w.value.filter(e=>!t.includes(e.id)),E.value=[],p.success("批量删除成功")}catch(t){console.error("批量删除图书失败:",t),t.response&&t.response.data?p.error(`批量删除图书失败: ${t.response.data}`):p.error("批量删除图书失败")}}).catch(()=>{})},Je=()=>{O.value="",U.value="",I.value="",P.value=1},Qe=()=>{R.value="",$.value="",A.value=1},ie=async()=>{console.log("执行订单搜索，条件：",{orderNumber:z.value,user:M.value,date:D.value}),!z.value&&!M.value&&!D.value&&await ue()},Xe=async()=>{z.value="",M.value="",D.value="",F.value=1,await ue()},ue=async()=>{try{const t=await x.get("https://smart-book-city.onrender.com/api/orders/paged",{params:{page:F.value,size:b.value}});console.log("从服务器加载订单数据:",t.data),t.data&&t.data.orders?(L.value=t.data.orders,T.value=t.data.total||0):t.data&&Array.isArray(t.data)?(L.value=t.data,T.value=t.data.length):console.warn("订单数据格式不正确:",t.data)}catch(t){console.error("加载订单数据失败:",t),p.error("加载订单数据失败")}},Ze=t=>{P.value=t,console.log("图书当前页码:",t)},et=async t=>{A.value=t,console.log("用户当前页码:",t);try{const e=await x.get("https://smart-book-city.onrender.com/api/users/paged",{params:{page:A.value,size:b.value}});console.log("用户分页数据:",e.data),e.data&&e.data.users?(K.value=e.data.users,B.value=e.data.total||0):e.data&&Array.isArray(e.data.users)?(K.value=e.data.users,B.value=e.data.users.length):console.warn("用户数据格式不正确:",e.data)}catch(e){console.error("加载用户数据失败:",e),p.error("加载用户数据失败")}await Ue()},tt=async t=>{F.value=t,console.log("订单当前页码:",t),!z.value&&!M.value&&!D.value&&await ue()},ze=Q(()=>!O.value&&!U.value&&!I.value&&!se.value?w.value:w.value.filter(t=>{const e=!O.value||t.title.toLowerCase().includes(O.value.toLowerCase()),a=!U.value||t.author.toLowerCase().includes(U.value.toLowerCase()),r=!I.value||t.category&&at(t.category,I.value),u=!se.value||t.title.toLowerCase().includes(se.value.toLowerCase())||t.author.toLowerCase().includes(se.value.toLowerCase());return e&&a&&r&&u})),at=(t,e)=>{if(!t||!e)return!1;const a=t.trim().toLowerCase(),r=e.trim().toLowerCase();if(a===r)return!0;for(const u in ee)if(a.includes(u.toLowerCase())&&u.toLowerCase()===r)return!0;return!1},Le=Q(()=>{const t=(P.value-1)*b.value,e=t+b.value;return ze.value.slice(t,e)}),lt=Q(()=>!R.value&&!$.value?K.value:K.value.filter(t=>{const e=!R.value||t.username&&t.username.toLowerCase().includes(R.value.toLowerCase()),a=!$.value||t.email&&t.email.toLowerCase().includes($.value.toLowerCase());return e&&a})),ot=Q(()=>{const t=(A.value-1)*b.value,e=t+b.value;return lt.value.slice(t,e)}),st=Q(()=>L.value.filter(t=>{var u;const e=!z.value||t.orderNumber&&t.orderNumber.toLowerCase().includes(z.value.toLowerCase())||t.id.toString().includes(z.value),a=!M.value||((u=t.user)==null?void 0:u.username)&&t.user.username.toLowerCase().includes(M.value.toLowerCase()),r=!D.value||t.orderDate&&we(t.orderDate).startsWith(D.value);return e&&a&&r})),nt=Q(()=>{if(z.value||M.value||D.value){const t=(F.value-1)*b.value,e=t+b.value;return st.value.slice(t,e)}return L.value}),we=t=>{if(!t)return"";const e=new Date(t);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`},Me=t=>({0:"待支付",1:"已完成"})[t]||"未知状态",De=t=>({0:"warning",1:"success"})[t]||"",rt=t=>{var e;return t.bookTitle||((e=t.book)==null?void 0:e.title)||""},it=t=>{var e;return t.bookAuthor||((e=t.book)==null?void 0:e.author)||""},Be=t=>{var e;return t.price||((e=t.book)==null?void 0:e.price)||0},Y=i(!1),j=i("add"),Ae=i(),g=i({id:0,title:"",author:"",price:0,stock:0,category:"",description:""}),Ee=[{value:"novel",label:"文学小说"},{value:"technology",label:"科技计算机"},{value:"education",label:"社会科学"},{value:"economics",label:"经济管理"},{value:"history",label:"历史传记"},{value:"art",label:"艺术设计"},{value:"children",label:"儿童读物"}],ee={novel:"文学小说",novell:"文学小说",literature:"文学小说",drama:"文学小说",poetry:"文学小说",technology:"科技计算机",science:"科技计算机",design:"科技计算机",environment:"科技计算机",education:"社会科学",sociology:"社会科学",philosophy:"社会科学",psychology:"社会科学",economics:"经济管理",management:"经济管理",marketing:"经济管理",history:"历史传记",biography:"历史传记",military:"历史传记",art:"艺术设计",film:"艺术设计",game:"艺术设计",children:"儿童读物"},Oe=t=>{if(!t)return"未分类";const e=t.trim().replace(/\s+/g,""),a=e.toLowerCase();if(ee[a])return ee[a];for(const r in ee)if(a.includes(r.toLowerCase()))return ee[r];return/[\u4e00-\u9fa5]/.test(e)?e:"未分类"},ut={title:[{required:!0,message:"请输入图书标题",trigger:"blur"}],author:[{required:!0,message:"请输入作者姓名",trigger:"blur"}],price:[{required:!0,message:"请输入价格",trigger:"blur"},{type:"number",min:0,message:"价格必须大于等于0",trigger:"blur"}],stock:[{required:!0,message:"请输入库存",trigger:"blur"},{type:"number",min:0,message:"库存必须大于等于0",trigger:"blur"}],category:[{required:!0,message:"请选择图书分类",trigger:"change"}]},dt=()=>{j.value="add",g.value={id:0,title:"",author:"",price:0,stock:0,category:"",description:""},Y.value=!0},ct=t=>{j.value="edit",g.value={...t},Y.value=!0},vt=async t=>{t&&await t.validate(async e=>{if(e)try{if(j.value==="add"){const a=await x.post("https://smart-book-city.onrender.com/api/books",g.value);a.data&&a.data.success&&a.data.data&&(w.value.push(a.data.data),p.success("图书添加成功"))}else{const a=await x.put(`https://smart-book-city.onrender.com/api/books/${g.value.id}`,g.value);if(a.data&&a.data.success&&a.data.data){const r=w.value.findIndex(u=>u.id===g.value.id);r!==-1&&(w.value[r]=a.data.data),p.success("图书更新成功")}}Y.value=!1}catch(a){console.error(j.value==="add"?"添加图书失败:":"更新图书失败:",a),p.error(j.value==="add"?"添加图书失败":"更新图书失败")}})},pt=t=>{We.confirm(`确定要删除图书《${t.title}》吗？此操作不可恢复！`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await x.delete(`https://smart-book-city.onrender.com/api/books/${t.id}`);const e=w.value.findIndex(a=>a.id===t.id);e!==-1&&w.value.splice(e,1),p.success("删除成功")}catch(e){console.error("删除图书失败:",e),e.response&&e.response.data?p.error(`删除图书失败: ${e.response.data}`):p.error("删除图书失败")}}).catch(()=>{})},Ue=async()=>{try{const t=await x.get("https://smart-book-city.onrender.com/api/users/order-counts");console.log("从服务器获取用户订单数量:",t.data),W.value=t.data}catch(t){console.error("获取用户订单数量失败:",t),p.error("获取用户订单数量失败"),W.value={},L.value.forEach(e=>{if(e.user&&e.user.id){const a=e.user.id;W.value[a]||(W.value[a]=0),W.value[a]++}})}},mt=t=>W.value[t]||0,Ie=async t=>{Ve.value=t,ne.value=!0,ye.value=!0,C.value=null;try{const e=L.value.find(a=>a.id===t);if(e)C.value=e;else{const a=await x.get(`https://smart-book-city.onrender.com/api/orders/${t}`);a.data&&(C.value=a.data)}}catch(e){console.error("获取订单详情失败:",e),p.error("获取订单详情失败")}finally{ye.value=!1}},N=i("month"),gt=i(null),ft=i(null),ht=i(null),yt=i(null),te=i([]),ae=i([]),q=i([]),de=i([]),G=i("0.00"),ce=i(0),ve=i(0),pe=i(0),bt=t=>{const e=[],a=new Date;switch(t){case"day":for(let r=6;r>=0;r--){const u=new Date(a);u.setDate(u.getDate()-r),e.push({date:`${u.getMonth()+1}/${u.getDate()}`,value:Math.floor(Math.random()*5e3)+1e3})}break;case"week":for(let r=7;r>=0;r--){const u=new Date(a);u.setDate(u.getDate()-r*7),e.push({date:`第${8-r}周`,value:Math.floor(Math.random()*15e3)+5e3})}break;case"month":for(let r=11;r>=0;r--){const u=new Date(a);u.setMonth(u.getMonth()-r),e.push({date:`${u.getFullYear()}/${u.getMonth()+1}`,value:Math.floor(Math.random()*5e4)+2e4})}break;case"year":for(let r=4;r>=0;r--){const u=a.getFullYear()-r;e.push({date:u.toString(),value:Math.floor(Math.random()*2e5)+1e5})}break}return e},wt=()=>[{title:"三体",sales:156},{title:"JavaScript高级程序设计",sales:142},{title:"活着",sales:138},{title:"人类简史",sales:125},{title:"小王子",sales:118},{title:"百年孤独",sales:112},{title:"深入理解计算机系统",sales:98},{title:"哈利·波特与魔法石",sales:95},{title:"经济学原理",sales:87},{title:"平凡的世界",sales:82}],kt=()=>[{name:"小说",value:1167},{name:"科技",value:856},{name:"教育",value:743},{name:"经济",value:625},{name:"历史",value:512},{name:"艺术",value:398},{name:"儿童",value:687}],_t=()=>[{name:"待付款",value:23},{name:"已付款",value:45},{name:"已发货",value:67},{name:"已完成",value:189},{name:"已取消",value:12}],xt=async()=>{try{const t=await x.get("https://smart-book-city.onrender.com/api/statistics/dashboard");t.data?(G.value=t.data.totalSales?t.data.totalSales.toFixed(2):"0.00",ce.value=t.data.totalOrders||0,ve.value=t.data.totalUsers||0,pe.value=t.data.totalBooks||0):(L.value.length>0?G.value=L.value.reduce((e,a)=>a.status===1||a.status===2||a.status===3?e+a.totalAmount:e,0).toFixed(2):G.value="0.00",ce.value=T.value>0?T.value:0,ve.value=B.value>0?B.value:0,pe.value=w.value.length>0?w.value.length:0)}catch(t){console.error("加载统计摘要数据失败:",t),L.value.length>0?G.value=L.value.reduce((e,a)=>a.status===1||a.status===2||a.status===3?e+a.totalAmount:e,0).toFixed(2):G.value="0.00",ce.value=T.value>0?T.value:0,ve.value=B.value>0?B.value:0,pe.value=w.value.length>0?w.value.length:0}},Ct=async()=>{try{await xt(),console.log("使用真实API数据进行展示");const t=await x.get("https://smart-book-city.onrender.com/api/statistics/sales",{params:{period:N.value}});te.value=t.data||[],console.log("销售统计数据:",te.value);const e=await x.get("https://smart-book-city.onrender.com/api/statistics/top-books",{params:{limit:10}});ae.value=e.data||[],console.log("畅销书籍排行数据:",ae.value);const a=await x.get("https://smart-book-city.onrender.com/api/statistics/category-sales");q.value=a.data||[],console.log("分类数据:",q.value);const r=await x.get("https://smart-book-city.onrender.com/api/statistics/order-status");de.value=r.data||[],console.log("订单状态数据:",de.value)}catch(t){console.error("加载统计数据失败:",t),p.error("加载统计数据失败"),console.log("API调用失败，使用模拟数据进行展示"),te.value=bt(N.value),ae.value=wt(),q.value=kt(),de.value=_t()}},me=async()=>{if(V.value!=="stats")return;H.length=0;const t=Ot.service({lock:!0,text:"加载统计数据中...",background:"rgba(255, 255, 255, 0.7)"});try{await Ct(),await Ut()}catch(a){console.error("初始化图表失败:",a),p.error("初始化图表失败")}finally{t.close()}if(!window.echarts){const a=document.createElement("script");a.src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js",a.async=!0,document.head.appendChild(a),await new Promise(r=>{a.onload=r})}const e=window.echarts;if(document.getElementById("sales-chart")){const a=e.init(document.getElementById("sales-chart"),null,{renderer:"canvas",useDirtyRect:!1,devicePixelRatio:window.devicePixelRatio});H.push(a);let r="日";switch(N.value){case"day":r="日";break;case"week":r="周";break;case"month":r="月";break;case"year":r="年";break}a.setOption({title:{text:`${r}销售额趋势`,left:"center",top:5,padding:[0,0,5,0],textStyle:{fontSize:14}},tooltip:{trigger:"axis"},grid:{left:"15%",right:"5%",bottom:"25%",top:"18%",containLabel:!0},xAxis:{type:"category",data:te.value.map(d=>d.date),axisLabel:{interval:"auto",rotate:N.value==="month"?45:0,margin:15,fontSize:10,align:"center",hideOverlap:!0},axisTick:{length:4,lineStyle:{width:1}}},yAxis:{type:"value",name:"销售额 (元)",nameTextStyle:{padding:[0,0,0,40],fontSize:12},axisLabel:{margin:12,formatter:"{value}",fontSize:11,align:"right",padding:[0,0,0,0]},splitLine:{lineStyle:{color:"#eee"}},offset:0,position:"left"},series:[{name:"销售额",type:"line",data:te.value.map(d=>d.value),smooth:!0,lineStyle:{width:3,color:"#409EFF"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(64, 158, 255, 0.5)"},{offset:1,color:"rgba(64, 158, 255, 0.1)"}]}}}]});const u=new ResizeObserver(()=>{a.resize()}),k=document.getElementById("sales-chart");k&&u.observe(k),window.addEventListener("resize",()=>{a.resize()})}if(document.getElementById("top-books-chart")){const a=e.init(document.getElementById("top-books-chart"),null,{renderer:"canvas",useDirtyRect:!1,devicePixelRatio:window.devicePixelRatio});H.push(a),a.setOption({tooltip:{trigger:"item",axisPointer:{type:"none"},formatter:"{b}: {c}",padding:5,textStyle:{fontSize:12}},grid:{left:"3%",right:"4%",bottom:"10%",top:"2%",containLabel:!0},xAxis:{type:"value",name:"",nameLocation:"middle",nameGap:25,minInterval:1,max:function(k){return Math.ceil(k.max*1.1)},axisLabel:{formatter:"{value}",fontSize:11,margin:8},nameTextStyle:{fontSize:12,fontWeight:"bold",padding:[5,0,0,0],align:"center"},splitLine:{show:!0,lineStyle:{color:"#f0f0f0",type:"dashed"}}},yAxis:{type:"category",data:ae.value.map(k=>k.title),inverse:!0,axisLabel:{width:150,overflow:"truncate",interval:0,margin:10,fontSize:12,lineHeight:12,padding:[1,0,1,0],height:14,fontWeight:"bold"},axisTick:{alignWithLabel:!0,length:4,lineStyle:{width:1.5}},splitLine:{show:!1},axisPointer:{type:"none"}},series:[{name:"销量",type:"bar",data:ae.value.map(k=>k.sales),barWidth:28,barGap:"0%",barCategoryGap:"5%",itemStyle:{color:"#67C23A",borderRadius:[0,4,4,0]},emphasis:{itemStyle:{color:"#85ce61"},scale:!1}}]});const r=new ResizeObserver(()=>{a.resize({animation:{duration:300}})}),u=document.getElementById("top-books-chart");u&&r.observe(u),window.addEventListener("resize",()=>{a.resize({animation:{duration:300}})}),window.addEventListener("zoom",()=>{a.resize({animation:{duration:300}})})}if(document.getElementById("category-chart")){const a=e.init(document.getElementById("category-chart"),null,{renderer:"canvas",useDirtyRect:!1,devicePixelRatio:window.devicePixelRatio});H.push(a),(!q.value||q.value.length===0)&&(q.value=[{name:"暂无数据",value:0}]);const r=q.value.map(d=>({name:Oe(d.name),value:d.value||0}));a.setOption({tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c}本 ({d}%)"},legend:{orient:"vertical",right:10,top:"center",data:r.map(d=>d.name||"未分类")},series:[{name:"书籍数量",type:"pie",radius:["40%","65%"],center:["40%","50%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!0,formatter:"{b}: {d}%",position:"outside"},emphasis:{label:{show:!0,fontSize:"16",fontWeight:"bold"}},labelLine:{show:!0},data:r}]});const u=new ResizeObserver(()=>{a.resize()}),k=document.getElementById("category-chart");k&&u.observe(k),window.addEventListener("resize",()=>{a.resize()})}if(document.getElementById("order-status-chart")){const a=e.init(document.getElementById("order-status-chart"),null,{renderer:"canvas",useDirtyRect:!1,devicePixelRatio:window.devicePixelRatio});H.push(a);const r={待付款:"#E6A23C",已付款:"#409EFF",已发货:"#67C23A",已完成:"#67C23A",已取消:"#F56C6C"};let u=de.value;(!u||u.length===0)&&(u=[{name:"待付款",value:23},{name:"已付款",value:45},{name:"已发货",value:67},{name:"已完成",value:189},{name:"已取消",value:12}]),a.setOption({tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",right:10,top:"center",data:u.map(_=>_.name||"未知状态")},series:[{name:"订单状态",type:"pie",radius:"55%",center:["40%","50%"],data:u.map(_=>({name:_.name||"未知状态",value:_.value||0,itemStyle:{color:r[_.name]||"#409EFF"}})),label:{show:!0,formatter:"{b}: {d}%"},emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]});const k=new ResizeObserver(()=>{a.resize()}),d=document.getElementById("order-status-chart");d&&k.observe(d),window.addEventListener("resize",()=>{a.resize()})}},St=t=>{N.value=t,me()},H=[],ge=()=>{H.forEach(t=>{t&&typeof t.resize=="function"&&t.resize({animation:{duration:300}})})};return Ke(()=>{window.addEventListener("resize",ge),window.matchMedia("(resolution: 1dppx)").addEventListener("change",ge)}),It(()=>{window.removeEventListener("resize",ge),window.matchMedia("(resolution: 1dppx)").removeEventListener("change",ge)}),xe(V,t=>{t==="stats"&&me()}),xe(()=>he.query.activeMenu,t=>{t&&["books","users","orders","stats"].includes(t)&&(V.value=t)},{immediate:!0}),xe(N,()=>{me()}),(t,e)=>{const a=m("el-icon"),r=m("el-menu-item"),u=m("el-menu"),k=m("el-aside"),d=m("el-button"),_=m("el-input"),Re=m("el-option"),$e=m("el-select"),S=m("el-table-column"),Pe=m("el-table"),ke=m("el-pagination"),Vt=m("el-date-picker"),Fe=m("el-tag"),zt=m("el-main"),Te=m("el-container"),J=m("el-form-item"),Ne=m("el-input-number"),Lt=m("el-form"),qe=m("el-dialog"),Mt=m("el-empty");return y(),h(X,null,[o(qt),l("div",Kt,[o(Te,null,{default:n(()=>[o(k,{width:"160px"},{default:n(()=>[o(u,{"default-active":V.value,class:"admin-menu",onSelect:je},{default:n(()=>[o(r,{index:"books"},{default:n(()=>[o(a,null,{default:n(()=>[o(fe(Rt))]),_:1}),e[23]||(e[23]=l("span",null,"图书管理",-1))]),_:1}),o(r,{index:"users"},{default:n(()=>[o(a,null,{default:n(()=>[o(fe($t))]),_:1}),e[24]||(e[24]=l("span",null,"用户管理",-1))]),_:1}),o(r,{index:"orders"},{default:n(()=>[o(a,null,{default:n(()=>[o(fe(Pt))]),_:1}),e[25]||(e[25]=l("span",null,"订单管理",-1))]),_:1}),o(r,{index:"stats"},{default:n(()=>[o(a,null,{default:n(()=>[o(fe(Ft))]),_:1}),e[26]||(e[26]=l("span",null,"数据统计",-1))]),_:1})]),_:1},8,["default-active"])]),_:1}),o(Te,null,{default:n(()=>[o(zt,null,{default:n(()=>[V.value==="books"?(y(),h("div",Wt,[l("div",Yt,[l("div",jt,[o(d,{type:"primary",onClick:dt},{default:n(()=>e[27]||(e[27]=[v(" 添加图书 ")])),_:1}),o(d,{type:"danger",onClick:He,disabled:E.value.length===0},{default:n(()=>e[28]||(e[28]=[v(" 批量删除 ")])),_:1},8,["disabled"]),E.value.length>0?(y(),h("span",Gt," 已选择 "+c(E.value.length)+" 项 ",1)):le("",!0)]),l("div",Ht,[o(_,{modelValue:O.value,"onUpdate:modelValue":e[0]||(e[0]=s=>O.value=s),placeholder:"书名",style:{width:"150px","margin-left":"16px"},clearable:"",onKeyup:Z(re,["enter"])},null,8,["modelValue"]),o(_,{modelValue:U.value,"onUpdate:modelValue":e[1]||(e[1]=s=>U.value=s),placeholder:"作者",style:{width:"150px","margin-left":"8px"},clearable:"",onKeyup:Z(re,["enter"])},null,8,["modelValue"]),o($e,{modelValue:I.value,"onUpdate:modelValue":e[2]||(e[2]=s=>I.value=s),placeholder:"分类",style:{width:"150px","margin-left":"8px"},clearable:"",onChange:re},{default:n(()=>[(y(),h(X,null,oe(Ee,s=>o(Re,{key:s.value,label:s.label,value:s.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),o(d,{type:"primary",onClick:re,style:{width:"80px","margin-left":"4px"}},{default:n(()=>e[29]||(e[29]=[v(" 搜索 ")])),_:1}),o(d,{type:"info",onClick:Je,style:{width:"80px","margin-left":"4px"}},{default:n(()=>e[30]||(e[30]=[v(" 重置 ")])),_:1})])]),o(Pe,{data:Le.value,style:{width:"100%"},"header-cell-style":{backgroundColor:"#f5f7fa",color:"#606266",fontWeight:"bold",textAlign:"center"},"cell-style":{textAlign:"center"},class:"larger-font-table",onSelectionChange:Ge},{default:n(()=>[o(S,{type:"selection",width:"55",align:"center"}),o(S,{label:"编号",width:"70",align:"center"},{default:n(s=>[v(c((P.value-1)*b.value+s.$index+1),1)]),_:1}),o(S,{prop:"title",label:"标题",align:"center"}),o(S,{prop:"author",label:"作者",width:"150",align:"center"}),o(S,{prop:"price",label:"价格",width:"100",align:"center"},{default:n(s=>[v(" ¥"+c(s.row.price),1)]),_:1}),o(S,{prop:"stock",label:"库存",width:"100",align:"center"}),o(S,{prop:"category",label:"分类",width:"120",align:"center"},{default:n(s=>[v(c(Oe(s.row.category)),1)]),_:1}),o(S,{label:"操作",width:"200",align:"center"},{default:n(s=>[o(d,{size:"small",type:"primary",onClick:f=>ct(s.row)},{default:n(()=>e[31]||(e[31]=[v(" 编辑 ")])),_:2},1032,["onClick"]),o(d,{size:"small",type:"danger",onClick:f=>pt(s.row)},{default:n(()=>e[32]||(e[32]=[v(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),l("div",Jt,[o(ke,{"current-page":P.value,"onUpdate:currentPage":e[3]||(e[3]=s=>P.value=s),"page-size":b.value,total:ze.value.length,layout:"total, prev, pager, next, jumper",onCurrentChange:Ze},null,8,["current-page","page-size","total"])])])):le("",!0),V.value==="users"?(y(),h("div",Qt,[l("div",Xt,[l("div",Zt,[o(_,{modelValue:R.value,"onUpdate:modelValue":e[4]||(e[4]=s=>R.value=s),placeholder:"用户名",style:{width:"150px"},clearable:"",onKeyup:Z(be,["enter"])},null,8,["modelValue"]),o(_,{modelValue:$.value,"onUpdate:modelValue":e[5]||(e[5]=s=>$.value=s),placeholder:"邮箱",style:{width:"150px","margin-left":"8px"},clearable:"",onKeyup:Z(be,["enter"])},null,8,["modelValue"]),o(d,{type:"primary",onClick:be,style:{width:"80px","margin-left":"4px"}},{default:n(()=>e[33]||(e[33]=[v(" 搜索 ")])),_:1}),o(d,{type:"info",onClick:Qe,style:{width:"80px","margin-left":"4px"}},{default:n(()=>e[34]||(e[34]=[v(" 重置 ")])),_:1})])]),o(Pe,{data:ot.value,style:{width:"100%"},"header-cell-style":{backgroundColor:"#f5f7fa",color:"#606266",fontWeight:"bold",textAlign:"center"},"cell-style":{textAlign:"center"},class:"larger-font-table"},{default:n(()=>[o(S,{label:"ID",width:"80",align:"center"},{default:n(s=>[v(c((A.value-1)*b.value+s.$index+1),1)]),_:1}),o(S,{prop:"username",label:"用户名",width:"150",align:"center"}),o(S,{prop:"email",label:"邮箱",align:"center"}),o(S,{label:"订单数",width:"120",align:"center"},{default:n(s=>[v(c(mt(s.row.id)),1)]),_:1})]),_:1},8,["data"]),l("div",ea,[o(ke,{"current-page":A.value,"onUpdate:currentPage":e[6]||(e[6]=s=>A.value=s),"page-size":b.value,total:B.value,layout:"total, prev, pager, next, jumper",onCurrentChange:et},null,8,["current-page","page-size","total"])])])):le("",!0),V.value==="orders"?(y(),h("div",ta,[l("div",aa,[l("div",la,[o(_,{modelValue:z.value,"onUpdate:modelValue":e[7]||(e[7]=s=>z.value=s),placeholder:"订单号",style:{width:"150px"},clearable:"",onKeyup:Z(ie,["enter"])},null,8,["modelValue"]),o(_,{modelValue:M.value,"onUpdate:modelValue":e[8]||(e[8]=s=>M.value=s),placeholder:"用户",style:{width:"120px","margin-left":"8px"},clearable:"",onKeyup:Z(ie,["enter"])},null,8,["modelValue"]),o(Vt,{modelValue:D.value,"onUpdate:modelValue":e[9]||(e[9]=s=>D.value=s),type:"date",placeholder:"下单日期",style:{width:"150px","margin-left":"8px"},"value-format":"YYYY-MM-DD",onChange:ie},null,8,["modelValue"]),o(d,{type:"primary",onClick:ie,style:{width:"80px","margin-left":"4px"}},{default:n(()=>e[35]||(e[35]=[v(" 搜索 ")])),_:1}),o(d,{type:"info",onClick:Xe,style:{width:"80px","margin-left":"4px"}},{default:n(()=>e[36]||(e[36]=[v(" 重置 ")])),_:1})])]),l("table",oa,[e[38]||(e[38]=l("thead",null,[l("tr",null,[l("th",null,"编号"),l("th",null,"订单号"),l("th",null,"用户"),l("th",null,"下单日期"),l("th",null,"金额"),l("th",null,"状态"),l("th",null,"操作")])],-1)),l("tbody",null,[(y(!0),h(X,null,oe(nt.value,(s,f)=>{var _e;return y(),h("tr",{key:s.id},[l("td",null,c((F.value-1)*b.value+f+1),1),l("td",null,c(s.orderNumber||s.id),1),l("td",null,c(((_e=s.user)==null?void 0:_e.username)||"未知用户"),1),l("td",null,c(we(s.orderDate)),1),l("td",null,"¥"+c(s.totalAmount),1),l("td",null,[o(Fe,{type:De(s.status)},{default:n(()=>[v(c(Me(s.status)),1)]),_:2},1032,["type"])]),l("td",null,[o(d,{size:"small",type:"primary",onClick:qa=>Ie(s.id)},{default:n(()=>e[37]||(e[37]=[v(" 查看详情 ")])),_:2},1032,["onClick"])])])}),128))])]),l("div",sa,[o(ke,{"current-page":F.value,"onUpdate:currentPage":e[10]||(e[10]=s=>F.value=s),"page-size":b.value,total:T.value,layout:"total, prev, pager, next, jumper",onCurrentChange:tt},null,8,["current-page","page-size","total"])])])):le("",!0),V.value==="stats"?(y(),h("div",na,[l("div",ra,[l("div",ia,[l("div",ua,c(G.value)+"元",1),e[39]||(e[39]=l("div",{class:"stats-card-title"},"总销售额",-1))]),l("div",da,[l("div",ca,c(ce.value),1),e[40]||(e[40]=l("div",{class:"stats-card-title"},"总订单数",-1))]),l("div",va,[l("div",pa,c(ve.value),1),e[41]||(e[41]=l("div",{class:"stats-card-title"},"用户总数",-1))]),l("div",ma,[l("div",ga,c(pe.value),1),e[42]||(e[42]=l("div",{class:"stats-card-title"},"图书总数",-1))])]),l("div",fa,[l("div",ha,[e[43]||(e[43]=l("h3",null,"销售统计",-1)),l("div",ya,[(y(),h(X,null,oe({day:"日",week:"周",month:"月",year:"年"},(s,f)=>l("span",{key:f,class:Tt({active:N.value===f}),onClick:_e=>St(f)},c(s),11,ba)),64))]),l("div",{class:"chart",id:"sales-chart",ref_key:"salesChart",ref:gt},null,512)]),l("div",wa,[e[44]||(e[44]=l("h3",null,"畅销书籍排行",-1)),l("div",{class:"chart",id:"top-books-chart",ref_key:"topBooksChart",ref:ft},null,512)]),l("div",ka,[e[45]||(e[45]=l("h3",null,"分类书籍数量比例",-1)),l("div",{class:"chart",id:"category-chart",ref_key:"categoryChart",ref:ht},null,512)]),l("div",_a,[e[46]||(e[46]=l("h3",null,"订单状态分布",-1)),l("div",{class:"chart",id:"order-status-chart",ref_key:"orderStatusChart",ref:yt},null,512)])])])):le("",!0)]),_:1})]),_:1})]),_:1}),o(qe,{title:j.value==="add"?"添加图书":"编辑图书",modelValue:Y.value,"onUpdate:modelValue":e[19]||(e[19]=s=>Y.value=s),width:"400px"},{footer:n(()=>[l("span",xa,[o(d,{onClick:e[17]||(e[17]=s=>Y.value=!1)},{default:n(()=>e[47]||(e[47]=[v("取消")])),_:1}),o(d,{type:"primary",onClick:e[18]||(e[18]=s=>vt(Ae.value))},{default:n(()=>e[48]||(e[48]=[v("确认")])),_:1})])]),default:n(()=>[o(Lt,{ref_key:"bookFormRef",ref:Ae,model:g.value,rules:ut,"label-width":"60px",class:"book-form"},{default:n(()=>[o(J,{label:"标题",prop:"title"},{default:n(()=>[o(_,{modelValue:g.value.title,"onUpdate:modelValue":e[11]||(e[11]=s=>g.value.title=s),placeholder:"请输入图书标题",class:"shorter-input"},null,8,["modelValue"])]),_:1}),o(J,{label:"作者",prop:"author"},{default:n(()=>[o(_,{modelValue:g.value.author,"onUpdate:modelValue":e[12]||(e[12]=s=>g.value.author=s),placeholder:"请输入作者姓名",class:"shorter-input"},null,8,["modelValue"])]),_:1}),o(J,{label:"价格",prop:"price"},{default:n(()=>[o(Ne,{modelValue:g.value.price,"onUpdate:modelValue":e[13]||(e[13]=s=>g.value.price=s),min:0,precision:2,step:1,class:"shorter-input"},null,8,["modelValue"])]),_:1}),o(J,{label:"库存",prop:"stock"},{default:n(()=>[o(Ne,{modelValue:g.value.stock,"onUpdate:modelValue":e[14]||(e[14]=s=>g.value.stock=s),min:0,step:1,class:"shorter-input"},null,8,["modelValue"])]),_:1}),o(J,{label:"分类",prop:"category"},{default:n(()=>[o($e,{modelValue:g.value.category,"onUpdate:modelValue":e[15]||(e[15]=s=>g.value.category=s),placeholder:"请选择图书分类",class:"shorter-input"},{default:n(()=>[(y(),h(X,null,oe(Ee,s=>o(Re,{key:s.value,label:s.label,value:s.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),o(J,{label:"描述",prop:"description"},{default:n(()=>[o(_,{modelValue:g.value.description,"onUpdate:modelValue":e[16]||(e[16]=s=>g.value.description=s),type:"textarea",rows:4,placeholder:"请输入图书描述",class:"description-input"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),o(qe,{modelValue:ne.value,"onUpdate:modelValue":e[22]||(e[22]=s=>ne.value=s),title:"订单详情",width:"700px",center:"","close-on-click-modal":!1},{footer:n(()=>[l("span",Fa,[o(d,{onClick:e[21]||(e[21]=s=>ne.value=!1)},{default:n(()=>e[57]||(e[57]=[v("关闭")])),_:1})])]),default:n(()=>{var s;return[ye.value?(y(),h("div",Ca,e[49]||(e[49]=[l("p",null,"加载中...",-1)]))):C.value?(y(),h("div",Sa,[l("div",Va,[l("div",za,[e[50]||(e[50]=l("span",{class:"detail-label"},"订单号:",-1)),l("span",La,c(C.value.orderNumber),1)]),l("div",Ma,[e[51]||(e[51]=l("span",{class:"detail-label"},"用户:",-1)),l("span",Da,c(((s=C.value.user)==null?void 0:s.username)||"未知用户"),1)]),l("div",Ba,[e[52]||(e[52]=l("span",{class:"detail-label"},"下单时间:",-1)),l("span",Aa,c(we(C.value.orderDate)),1)]),l("div",Ea,[e[53]||(e[53]=l("span",{class:"detail-label"},"订单状态:",-1)),o(Fe,{type:De(C.value.status)},{default:n(()=>[v(c(Me(C.value.status)),1)]),_:1},8,["type"])])]),l("div",Oa,[l("table",Ua,[e[54]||(e[54]=l("thead",null,[l("tr",null,[l("th",null,"书名"),l("th",null,"作者"),l("th",null,"单价"),l("th",null,"数量"),l("th",null,"小计")])],-1)),l("tbody",null,[(y(!0),h(X,null,oe(C.value.orderItems||C.value.items,f=>(y(),h("tr",{key:f.id},[l("td",null,c(rt(f)),1),l("td",null,c(it(f)),1),l("td",null,"¥"+c(Be(f).toFixed(2)),1),l("td",null,c(f.quantity),1),l("td",null,"¥"+c((Be(f)*f.quantity).toFixed(2)),1)]))),128))])])]),l("div",Ia,[l("div",Ra,[e[55]||(e[55]=v(" 订单总额: ")),l("span",$a,"¥"+c(C.value.totalAmount.toFixed(2)),1)])])])):(y(),h("div",Pa,[o(Mt,{description:"获取订单详情失败"},{default:n(()=>[o(d,{type:"primary",onClick:e[20]||(e[20]=f=>Ie(Ve.value))},{default:n(()=>e[56]||(e[56]=[v("重试")])),_:1})]),_:1})]))]}),_:1},8,["modelValue"])])],64)}}}),Ya=Nt(Ta,[["__scopeId","data-v-382d5ebe"]]);export{Ya as default};
