import{d as k,a as q,r as m,G as w,o as B,H as C,g as F,l as r,p as a,n,D as I,v,h as p,A as N,i as M,j as S,q as T,I as j,y as _,x as A,E as y,_ as D}from"./index-lJ9Ej1SP.js";const G={class:"register-container"},H={class:"form-footer"},z=k({__name:"Register",setup(J){const b=q(),x=A(),f=m(),g=m(!1),u=m(!1),c=m(null),s=w({username:"",password:"",confirmPassword:"",email:""}),V=w({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度应为3到20个字符",trigger:"blur"},{validator:(d,e,t)=>{if(e===""){t(new Error("请输入用户名"));return}if(e.length<3||e.length>20){t(new Error("用户名长度应为3到20个字符"));return}u.value=!0,I.post("https://smart-book-city.onrender.com/api/users/check-username",{username:e}).then(o=>{u.value=!1,o.data&&o.data.exists?t(new Error("用户名已存在，请更换其他用户名")):t()}).catch(()=>{u.value=!1,t()})},trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度应为6到20个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(d,e,t)=>{e===""?t(new Error("请再次输入密码")):e!==s.password?t(new Error("两次输入密码不一致")):t()},trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]});B(async()=>{await C(),c.value&&c.value.focus()});const h=async()=>{f.value&&await f.value.validate(async d=>{if(d){g.value=!0;try{const e=await b.register(s.username,s.password,s.email);e.success?(y.success("注册成功，请登录"),x.push("/login")):y.error(e.message)}finally{g.value=!1}}})};return(d,e)=>{const t=n("el-icon"),o=n("el-input"),i=n("el-form-item"),E=n("el-button"),U=n("el-form"),P=n("router-link"),R=n("el-card");return v(),F("div",G,[r(R,{class:"register-card"},{header:a(()=>e[4]||(e[4]=[p("div",{class:"card-header"},[p("h2",null,"用户注册")],-1)])),default:a(()=>[r(U,{model:s,rules:V,ref_key:"registerFormRef",ref:f,"label-position":"left","label-width":"80px",onSubmit:N(h,["prevent"])},{default:a(()=>[r(i,{label:"用户名",prop:"username"},{default:a(()=>[r(o,{modelValue:s.username,"onUpdate:modelValue":e[0]||(e[0]=l=>s.username=l),placeholder:"请输入用户名",clearable:"",style:{width:"220px"},ref_key:"usernameInputRef",ref:c},{suffix:a(()=>[u.value?(v(),M(t,{key:0,class:"is-loading"},{default:a(()=>[r(T(j))]),_:1})):S("",!0)]),_:1},8,["modelValue"])]),_:1}),r(i,{label:"密码",prop:"password"},{default:a(()=>[r(o,{modelValue:s.password,"onUpdate:modelValue":e[1]||(e[1]=l=>s.password=l),type:"password",placeholder:"请输入密码","show-password":"",clearable:"",style:{width:"220px"}},null,8,["modelValue"])]),_:1}),r(i,{label:"确认密码",prop:"confirmPassword"},{default:a(()=>[r(o,{modelValue:s.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=l=>s.confirmPassword=l),type:"password",placeholder:"请确认密码","show-password":"",clearable:"",style:{width:"220px"}},null,8,["modelValue"])]),_:1}),r(i,{label:"邮箱",prop:"email"},{default:a(()=>[r(o,{modelValue:s.email,"onUpdate:modelValue":e[3]||(e[3]=l=>s.email=l),placeholder:"请输入邮箱",clearable:"",style:{width:"220px"}},null,8,["modelValue"])]),_:1}),r(i,null,{default:a(()=>[r(E,{type:"primary",loading:g.value,style:{width:"150px","margin-left":"80px"},"native-type":"submit"},{default:a(()=>e[5]||(e[5]=[_(" 注册 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"]),p("div",H,[p("p",null,[e[7]||(e[7]=_(" 已有账号？ ")),r(P,{to:"/login"},{default:a(()=>e[6]||(e[6]=[_("去登录")])),_:1})])])]),_:1})])}}}),Q=D(z,[["__scopeId","data-v-b9c5e63e"]]);export{Q as default};
